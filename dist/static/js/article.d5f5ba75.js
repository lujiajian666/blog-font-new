(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{206:function(e,t,n){var r,o;
/*!
 * JavaScript Cookie v2.2.1
 * https://github.com/js-cookie/js-cookie
 *
 * Copyright 2006, 2015 Klaus Hartl & Fagner Brack
 * Released under the MIT license
 */!function(s){if(void 0===(o="function"==typeof(r=s)?r.call(t,n,t,e):r)||(e.exports=o),!0,e.exports=s(),!!0){var i=window.Cookies,a=window.Cookies=s();a.noConflict=function(){return window.Cookies=i,a}}}((function(){function e(){for(var e=0,t={};e<arguments.length;e++){var n=arguments[e];for(var r in n)t[r]=n[r]}return t}function t(e){return e.replace(/(%[0-9A-Z]{2})+/g,decodeURIComponent)}return function n(r){function o(){}function s(t,n,s){if("undefined"!=typeof document){"number"==typeof(s=e({path:"/"},o.defaults,s)).expires&&(s.expires=new Date(1*new Date+864e5*s.expires)),s.expires=s.expires?s.expires.toUTCString():"";try{var i=JSON.stringify(n);/^[\{\[]/.test(i)&&(n=i)}catch(e){}n=r.write?r.write(n,t):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),t=encodeURIComponent(String(t)).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/[\(\)]/g,escape);var a="";for(var c in s)s[c]&&(a+="; "+c,!0!==s[c]&&(a+="="+s[c].split(";")[0]));return document.cookie=t+"="+n+a}}function i(e,n){if("undefined"!=typeof document){for(var o={},s=document.cookie?document.cookie.split("; "):[],i=0;i<s.length;i++){var a=s[i].split("="),c=a.slice(1).join("=");n||'"'!==c.charAt(0)||(c=c.slice(1,-1));try{var l=t(a[0]);if(c=(r.read||r)(c,l)||t(c),n)try{c=JSON.parse(c)}catch(e){}if(o[l]=c,e===l)break}catch(e){}}return e?o[e]:o}}return o.set=s,o.get=function(e){return i(e,!1)},o.getJSON=function(e){return i(e,!0)},o.remove=function(t,n){s(t,"",e(n,{expires:-1}))},o.defaults={},o.withConverter=n,o}((function(){}))}))},207:function(e,t,n){},208:function(e,t,n){},211:function(e,t,n){"use strict";var r=n(207);n.n(r).a},212:function(e,t,n){"use strict";var r=n(208);n.n(r).a},213:function(e,t,n){"use strict";n.r(t);var r=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[e.tableData?n("div",{staticClass:"index",attrs:{id:"articlePage"}},[n("p",{staticClass:"tag"},[e._v("\n      lulujiang的个人博客\n      "),e._l(e.tags,(function(t,r){return n("span",{key:r,staticClass:"tags"},[e._v(e._s(e.types[t]))])}))],2),e._v(" "),n("div",{staticClass:"container ql-snow"},[n("div",{staticClass:"inner ql-editor"},[n("h1",[e._v(e._s(e.tableData.title))]),e._v(" "),n("p",{staticClass:"time"},[e._v(e._s(e.tableData.createTime))]),e._v(" "),n("div",{domProps:{innerHTML:e._s(e.tableData.text)}})]),e._v(" "),n("div",{staticClass:"comment-text-area"},[n("textarea",{directives:[{name:"model",rawName:"v-model",value:e.comment,expression:"comment"}],domProps:{value:e.comment},on:{input:function(t){t.target.composing||(e.comment=t.target.value)}}}),e._v(" "),n("input",{attrs:{type:"button",value:"发表"},on:{click:function(t){return e.addComment()}}}),e._v(" "),e.username?n("input",{staticClass:"logout",attrs:{type:"button",value:"退出登录"},on:{click:function(t){return e.logout()}}}):n("input",{staticClass:"login",attrs:{type:"button",value:"登录"},on:{click:function(t){return e.login()}}})]),e._v(" "),n("ul",{staticClass:"comment"},e._l(e.parentComment,(function(t,r){return n("li",{key:r},[n("span",[e._v("\n            "+e._s(t.username===e.tableData.username?"作者":t.username)+"：\n          ")]),e._v(" "),n("span",[e._v(e._s(t.content))]),e._v(" "),e.replyId===t.id?[n("br"),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.replyText,expression:"replyText"}],domProps:{value:e.replyText},on:{input:function(t){t.target.composing||(e.replyText=t.target.value)}}}),e._v(" "),n("span",{staticClass:"reply pointer cancel",on:{click:function(n){return e.cancelReply(t.id)}}},[e._v("取消")])]:e._e(),e._v(" "),t.username!==e.username?n("span",{staticClass:"reply pointer",on:{click:function(n){return e.reply(t.id)}}},[e._v("回复")]):e._e(),e._v(" "),n("ul",e._l(t.list,(function(t,r){return n("li",{key:r},[n("span",[e._v("\n                "+e._s(t.username===e.tableData.username?"作者":t.username)+"\n                回复\n                "+e._s(t.to===e.tableData.username?"作者":t.to)+"：\n              ")]),e._v(" "),n("span",[e._v(e._s(t.content))]),e._v(" "),e.replyId===t.id?[n("br"),e._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:e.replyText,expression:"replyText"}],domProps:{value:e.replyText},on:{input:function(t){t.target.composing||(e.replyText=t.target.value)}}}),e._v(" "),n("span",{staticClass:"reply pointer cancel",on:{click:function(n){return e.cancelReply(t.id)}}},[e._v("取消")])]:e._e(),e._v(" "),t.username!==e.username?n("span",{staticClass:"reply pointer",on:{click:function(n){return e.reply(t.id)}}},[e._v("回复")]):e._e()],2)})),0)],2)})),0)])]):e._e(),e._v(" "),e.showLogin?n("login-component"):e._e()],1)};r._withStripped=!0;var o=n(38),s=n(0),i=n(206),a=n.n(i),c=n(34),l=n.n(c),u=function(){var e=this,t=e.$createElement,n=e._self._c||t;return e.show?n("div",{staticClass:"login"},[n("i",{staticClass:"el-icon-error",on:{click:function(t){e.show=!1}}}),e._v(" "),n("div",[n("span",{staticClass:"login-button pointer",class:{actived:0===e.choosed},on:{click:function(t){return e.choose(0)}}},[e._v("登录")]),e._v(" "),n("span",{staticClass:"register-button pointer",class:{actived:1===e.choosed},on:{click:function(t){return e.choose(1)}}},[e._v("注册")])]),e._v(" "),n("el-form",{directives:[{name:"show",rawName:"v-show",value:0===e.choosed,expression:"choosed === 0"}],ref:"signInForm",attrs:{model:e.signInForm,"status-icon":"",rules:e.signInRule,"label-position":"left"}},[n("el-form-item",{attrs:{label:"账号",prop:"username"}},[n("el-input",{model:{value:e.signInForm.username,callback:function(t){e.$set(e.signInForm,"username",e._n(t))},expression:"signInForm.username"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.signInForm.password,callback:function(t){e.$set(e.signInForm,"password",t)},expression:"signInForm.password"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("signInForm")}}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:function(t){return e.resetForm("signInForm")}}},[e._v("重置")])],1)],1),e._v(" "),n("el-form",{directives:[{name:"show",rawName:"v-show",value:0!==e.choosed,expression:"choosed !== 0 "}],ref:"signUpForm",attrs:{model:e.signUpForm,"status-icon":"",rules:e.signUpRule,"label-position":"left"}},[n("el-form-item",{attrs:{label:"账号",prop:"username"}},[n("el-input",{model:{value:e.signUpForm.username,callback:function(t){e.$set(e.signUpForm,"username",e._n(t))},expression:"signUpForm.username"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"密码",prop:"password"}},[n("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.signUpForm.password,callback:function(t){e.$set(e.signUpForm,"password",t)},expression:"signUpForm.password"}})],1),e._v(" "),n("el-form-item",{attrs:{label:"确认密码",prop:"checkPass"}},[n("el-input",{attrs:{type:"password",autocomplete:"off"},model:{value:e.signUpForm.checkPass,callback:function(t){e.$set(e.signUpForm,"checkPass",t)},expression:"signUpForm.checkPass"}})],1),e._v(" "),n("el-form-item",[n("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("signUpForm")}}},[e._v("提交")]),e._v(" "),n("el-button",{on:{click:function(t){return e.resetForm("signUpForm")}}},[e._v("重置")])],1)],1)],1):e._e()};u._withStripped=!0;var p={data:function(){var e=this,t=function(e,t,n){if(t){/^[_A-Za-z0-9]{8,16}$/.test(t)?n():n(new Error("账号必须为下划线字母数字的8到16位组合"))}else n(new Error("账号不能为空"))},n=function(t,n,r){if(""===n)r(new Error("请输入密码"));else{if(/^[_A-Za-z0-9]{8,16}$/.test(n)){if(""!==e.signUpForm.password2){var o=e.$refs.signUpForm;o&&o.validateField("password2")}}else r(new Error("密码必须为下划线字母数字的8到16位组合"));r()}};return{show:!0,signUpForm:{password:"",checkPass:"",username:""},signInForm:{password:"",username:""},signUpRule:{password:[{validator:n,trigger:"blur"}],checkPass:[{validator:function(t,n,r){console.log("validatePass2"),""===n?r(new Error("不能为空")):n!==e.signUpForm.password?r(new Error("两次输入密码不一致!")):r()},trigger:"blur"}],username:[{validator:t,trigger:"blur"}]},signInRule:{password:[{validator:n,trigger:"blur"}],username:[{validator:t,trigger:"blur"}]},choosed:0}},created:function(){this.show=!a.a.get("username")},methods:{submitForm:function(e){var t=this;this.$refs[e].validate((function(n){if(!n)return t.$message.error("请正确填写信息"),!1;"signUpForm"===e?t.signUp():t.signIn()}))},resetForm:function(e){this.$refs[e].resetFields()},signUp:function(){var e=this;Object(o.b)("/article/user/register",{password:this.signUpForm.password,username:this.signUpForm.username}).then((function(t){e.$message.success(t.msg),window.location.reload()})).catch((function(t){e.resetForm("signUpForm"),e.$message.error(t.message)}))},signIn:function(){var e=this;Object(o.b)("/article/user/login",this.signInForm).then((function(t){e.$message.success("登录成功"),window.location.reload()})).catch((function(t){e.$message.error(t.message||t)}))},choose:function(e){var t=this.$refs[["signUpForm","signInForm"][e]];t&&t.resetFields(),this.choosed=e}}},m=(n(211),n(58)),d=Object(m.a)(p,u,[],!1,null,"70c98a68",null);d.options.__file="src/components/login/index.vue";var f=d.exports,g=s.default.extend(f),v={instance:null,el:"",install:function(){s.default.prototype.$login={_self:this,checkLogin:this.checkLogin}},getInstance:function(e,t){var n=this;return e===this.el&&this.instance?(this.instance.show=!0,l.a.resolve(this.instance)):new l.a((function(r,o){var s=new g({propsData:t}).$mount();document.querySelector(e).appendChild(s.$el);var i=[e,s];n.el=i[0],n.instance=i[1],r(s)}))},checkLogin:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"body",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=a.a.get("username");return n?l.a.resolve():this._self.getInstance(e,t).then((function(e){return l.a.reject({message:"未登录"})}))}},h={components:{loginComponent:v},data:function(){return{username:a.a.get("username"),types:null,showLogin:!1,comment:"",replyText:"",replyId:null,allComment:null,parentComment:null}},asyncData:function(e){var t=e.store,n=e.route;return t.dispatch("fetchArticle",n.params.id)},created:function(){var e=this;s.default.use(v),Object(o.a)("/article/type/get",{currentPage:1,pageSize:100}).then((function(t){e.types=t.data.list.reduce((function(e,t){return e[t.id]=t.name,e}),{})})).catch((function(e){console.log(e)})),this.getComment()},computed:{tags:function(){if(this.types)return this.tableData.types.split(";").filter((function(e){return!!e}))},tableData:function(){return this.$store.state.article[this.$route.params.id]}},methods:{addComment:function(e){var t=this,n=null;if(!(!e&&""===this.comment||e&&""===this.replyText))return this.$login.checkLogin("#articlePage").then((function(r){n=t.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"});var s={content:t.comment,parentId:"",articleId:t.$route.params.id};return e&&(s.parentId=e,s.content=t.replyText),Object(o.b)("/article/comment/add",s)})).then((function(e){n.close(),t.$message.success("发布成功"),t.comment="",t.getComment()})).catch((function(e){n&&n.close(),t.$message.error(e.message)}));this.$message.warning("请输入内容")},reply:function(e){var t=this;this.replyId!==e?this.replyId=e:this.addComment(e).then((function(e){t.replyId=null}))},cancelReply:function(e){this.replyId=null},getComment:function(){var e=this;Object(o.a)("/article/comment/get",{id:this.$route.params.id}).then((function(t){e.allComment=t.data})).then((function(t){var n=[],r=e.allComment.filter((function(e){return 0===e.parent_id})).reduce((function(e,t){return t.list=[],e[t.id]=t,n.push({id:t.id,username:t.username,parent:t.id}),e}),{});e.allComment.filter((function(e){return 0!==e.parent_id})).sort((function(e,t){return e.create_at<t.create_at?-1:1})).forEach((function(e){n.some((function(t){return e.parent_id===t.id&&(e.to=t.username,r[t.parent].list.push(e),n.push({id:e.id,username:e.username,parent:t.parent}),!0)}))})),e.parentComment=r,console.log(e.parentComment)})).catch((function(e){console.log(e)}))},logout:function(){var e=this.$loading({lock:!0,text:"Loading",spinner:"el-icon-loading",background:"rgba(0, 0, 0, 0.7)"}),t=new Date;t.setTime(-1e3),document.cookie="username='';path=/;expires=".concat(t.toUTCString()),this.username=null,e.close()},login:function(){this.$login.checkLogin("#articlePage")}}},_=(n(212),Object(m.a)(h,r,[],!1,null,"82768ea8",null));_.options.__file="src/views/Article.vue";t.default=_.exports}}]);
//# sourceMappingURL=article.d5f5ba75.js.map